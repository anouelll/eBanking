<div class="container mt-2">
  <div class="row">
    <div class="col-12">
      <h2>My Accounts</h2>
      
      <div *ngIf="accountsWithOperations.length === 0" class="alert alert-info">
        No accounts found.
      </div>

      <div *ngFor="let account of accountsWithOperations; let i = index" class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Account #{{ account.accountId || account.id }}</h5>
          <span class="badge" [ngClass]="account.balance >= 0 ? 'bg-success' : 'bg-danger'">
            {{ account.balance | currency:'EUR':'symbol':'1.2-2' }}
          </span>
        </div>
        
        <div class="card-body">
          <!-- Informations du compte -->
          <div class="row mb-3">
            <div class="col-md-4">
              <strong>Account Type:</strong> 
              <span class="badge" [ngClass]="{
                'bg-primary': account.type === 'CurrentAccount',
                'bg-success': account.type === 'SavingAccount'
              }">
                {{ account.type === 'CurrentAccount' ? 'Current' : 'Savings' }}
              </span>
            </div>
            <div class="col-md-4">
              <strong>Created:</strong> {{ account.createdAt | date:'short' }}
            </div>
            <div class="col-md-4">
              <strong>Status:</strong> 
              <span class="badge bg-success">{{ account.status || 'Active' }}</span>
            </div>
          </div>

          <!-- Row avec 2 colonnes : Opérations + Formulaire -->
          <div class="row">
            <!-- Colonne gauche : Liste des opérations -->
            <div class="col-md-7">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Recent Operations</h6>
                </div>
                <div class="card-body">
                  <div *ngIf="account.accountOperationDTOS && account.accountOperationDTOS.length > 0; else noOperations">
                    <div class="table-responsive">
                      <table class="table table-striped table-sm">
                        <thead class="table-dark">
                          <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Description</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let operation of account.accountOperationDTOS">
                            <td>{{ operation.operationDate | date:'short' }}</td>
                            <td>
                              <span class="badge badge-sm" 
                                    [ngClass]="{
                                      'bg-danger': operation.type === 'DEBIT',
                                      'bg-success': operation.type === 'CREDIT',
                                      'bg-warning': operation.type === 'TRANSFER'
                                    }">
                                {{ operation.type }}
                              </span>
                            </td>
                            <td [ngClass]="{
                                  'text-danger': operation.type === 'DEBIT',
                                  'text-success': operation.type === 'CREDIT'
                                }">
                              {{ operation.amount | currency:'EUR':'symbol':'1.2-2' }}
                            </td>
                            <td>{{ operation.description }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <ng-template #noOperations>
                    <div class="alert alert-light">
                      <i class="fas fa-info-circle"></i> No operations found for this account.
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>

            <!-- Colonne droite : Formulaire d'opérations -->
            <div class="col-md-5">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">New Operation</h6>
                </div>
                <div class="card-body">
                  <form [formGroup]="operationsFormGroup" (ngSubmit)="handleAccountOperation(account.accountId || account.id)">
                    
                    <!-- Type d'opération -->
                    <div class="mb-3">
                      <label class="form-label"><strong>Operation Type:</strong></label>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" formControlName="operationType" value="DEBIT" id="debit-{{ i }}">
                        <label class="form-check-label" for="debit-{{ i }}">
                          <span class="badge bg-danger">DEBIT</span> Withdrawal
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" formControlName="operationType" value="CREDIT" id="credit-{{ i }}">
                        <label class="form-check-label" for="credit-{{ i }}">
                          <span class="badge bg-success">CREDIT</span> Deposit
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" formControlName="operationType" value="TRANSFER" id="transfer-{{ i }}">
                        <label class="form-check-label" for="transfer-{{ i }}">
                          <span class="badge bg-warning">TRANSFER</span> Transfer
                        </label>
                      </div>
                    </div>

                    <!-- Montant -->
                    <div class="mb-3">
                      <label class="form-label">Amount (€):</label>
                      <input type="number" 
                             class="form-control" 
                             formControlName="amount" 
                             placeholder="Enter amount"
                             min="0.01"
                             step="0.01">
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                      <label class="form-label">Description:</label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="description" 
                             placeholder="Enter description">
                    </div>

                    <!-- Compte de destination (si TRANSFER) -->
                    <div class="mb-3" *ngIf="operationsFormGroup.value.operationType === 'TRANSFER'">
                      <label class="form-label">Destination Account ID:</label>
                      <input type="text" 
                             class="form-control" 
                             formControlName="accountDestination" 
                             placeholder="Enter destination account ID">
                    </div>

                    <!-- Bouton de soumission -->
                    <div class="d-grid">
                      <button class="btn btn-primary" 
                              type="submit" 
                              [disabled]="!operationsFormGroup.valid">
                        <i class="fas fa-save"></i> Execute Operation
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading state -->
      <div *ngIf="accountsWithOperations.length === 0" class="text-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </div>
</div>